.MODEL SMALL
.DATA
PROGRAM_NAME DB 256 DUP(?)
ENTER_PASSWORD DB 'Enter password:',10,13,'$'
ENTERED_PASSWORD DB 11,12 DUP(?)
CORRECT_PASSWORD DB 'Correct password!',10,13,'$'
GOODBYE DB 'Self-destruction!',10,13,'$'
ATTEMPTS DB 3
ATTEMPTS_LEFT DB 'Attempts left: $'
.CODE
	PASSWORD DB 'PASSWORD'
	PASSWORD_LENGTH EQU $-PASSWORD
	
WRITE_ATTEMPTS PROC
	MOV DX,OFFSET PROGRAM_NAME
	MOV AX,4300H
	INT 21H
	
	MOV AX,4301H
	AND CX,11111110B
	INT 21H
	
	MOV AX,3D02H
	INT 21H
	
	MOV BX,AX
	MOV CX,0
	MOV DX,0
	MOV AX,4202H
	INT 21H
	
	MOV CX,0
	SUB AX,17
	MOV DX,AX
	MOV AX,4200H
	INT 21H
	
	MOV DX,OFFSET ATTEMPTS
	MOV CX,1
	MOV AH,40H
	INT 21H
	
	MOV AH,3EH
	INT 21H
	RET
WRITE_ATTEMPTS ENDP
	
START:
	MOV AX,@DATA
	MOV DS,AX
	MOV AX,ES:[2CH]
	MOV ES,AX
	MOV SI,-1
	
SEARCH_01:
	ADD SI,1
	MOV AL,ES:[SI]
	CMP AL,0
	JNE SEARCH_01
	MOV AL,ES:[SI+1]
	CMP AL,1
	JNE SEARCH_01
	
	ADD SI,2
	MOV BX,OFFSET PROGRAM_NAME
	
COPY_NAME:
	ADD SI,1
	MOV AL,ES:[SI]
	MOV [BX],AL
	INC BX
	CMP AL,0
	JNE COPY_NAME
	
CHECK_PASSWORD:
	MOV DX,OFFSET ATTEMPTS_LEFT
	MOV AH,09H
	INT 21H
	MOV AL,ATTEMPTS
	ADD AL,30H
	INT 29H
	MOV AL,10
	INT 29H
	MOV AL,13
	INT 29H
	
	MOV DX,OFFSET ENTER_PASSWORD
	MOV AH,09H
	INT 21H
	
	MOV DX,OFFSET ENTERED_PASSWORD
	MOV AH,0AH
	INT 21H
	
	MOV AL,10
	INT 29H
	MOV AL,13
	INT 29H
	
	MOV BX,OFFSET ENTERED_PASSWORD
	MOV AL,[BX+1]
	XOR AH,AH
	MOV BX,PASSWORD_LENGTH
	CMP AX,BX
	JNE WRONG_PASSWORD
	MOV CX,AX
	MOV SI,OFFSET PASSWORD
	MOV DI,OFFSET ENTERED_PASSWORD
	ADD DI,2
	
COMPARE_PASSWORDS:
	MOV AL,CS:[SI]
	MOV AH,[DI]
	CMP AL,AH
	JNE WRONG_PASSWORD
	INC SI
	INC DI
	LOOP COMPARE_PASSWORDS
	
	MOV ATTEMPTS,3
	CALL WRITE_ATTEMPTS
	
	MOV AH,0FH
	INT 10H
	MOV AL,10
	MOV BL,7
	MOV CX,80
	MOV DX,0
	
PRINT_10_SYMBOL_LINE:
	MOV AH,02H
	INT 10H
	MOV AH,09H
	INT 10H
	INC DH
	CMP DH,25
	JNE PRINT_10_SYMBOL_LINE
	
	MOV AX,4C00H
	INT 21H
	
WRONG_PASSWORD:
	MOV AL,ATTEMPTS
	DEC AL
	CMP AL,0
	JE DESTROY
	
	MOV ATTEMPTS,AL
	CALL WRITE_ATTEMPTS
	JMP CHECK_PASSWORD
	
DESTROY:
	MOV DX,OFFSET PROGRAM_NAME
	MOV AX,4300H
	INT 21H
	
	AND CL,11111110B
	MOV AX,4301H
	INT 21H
	
	MOV AX,3D02H
	INT 21H
	
	MOV BX,AX
	MOV CX,0
	MOV DX,0
	MOV AX,4202H
	INT 21H
	
	MOV SI,AX
	MOV ATTEMPTS,0
	
	MOV CX,0
	MOV DX,0
	MOV AX,4200H
	INT 21H
	
CLEAR_FILE:
	MOV DX,OFFSET ATTEMPTS
	MOV CX,1
	MOV AH,40H
	INT 21H
	
	DEC SI
	CMP SI,0
	JE DELETE_FILE
	
	MOV CX,0
	MOV DX,1
	MOV AX,4201H
	INT 21H
	JMP CLEAR_FILE
	
DELETE_FILE:
	MOV AH,3EH
	INT 21H
	
	MOV DX,OFFSET PROGRAM_NAME
	MOV AH,41H
	INT 21H
	
	MOV DX,OFFSET GOODBYE
	MOV AH,09H
	INT 21H
	
	MOV AX,4C00H
	INT 21H
END START