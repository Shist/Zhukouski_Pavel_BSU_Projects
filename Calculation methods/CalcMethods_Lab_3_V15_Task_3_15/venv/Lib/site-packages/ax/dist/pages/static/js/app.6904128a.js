(function(e){function t(t){for(var r,s,i=t[0],c=t[1],u=t[2],d=0,f=[];d<i.length;d++)s=i[d],a[s]&&f.push(a[s][0]),a[s]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);l&&l(t);while(f.length)f.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],r=!0,i=1;i<n.length;i++){var c=n[i];0!==a[c]&&(r=!1)}r&&(o.splice(t--,1),e=s(s.s=n[0]))}return e}var r={},a={app:0},o=[];function s(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=r,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/pages/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var u=0;u<i.length;u++)t(i[u]);var l=c;o.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"0262":function(e){e.exports={"sign-out":"Sign out","goto-admin":"To admin console"}},"0911":function(e,t,n){t=e.exports=n("2350")(!1),t.push([e.i,".logo[data-v-3cea64d0]{height:50px;cursor:pointer}.logo-div[data-v-3cea64d0]{margin-bottom:15px;text-align:center}.user-div[data-v-3cea64d0]{color:rgba(0,0,0,.87);margin:auto;padding-top:40px;width:fit-content}.user-div a[data-v-3cea64d0]{cursor:pointer;text-decoration:underline;color:rgba(0,0,0,.87)}.to-admin[data-v-3cea64d0]{cursor:pointer;color:#7cb342!important}.tree-a[data-v-3cea64d0]{color:rgba(0,0,0,.87);text-decoration:none}",""])},"11be":function(e,t,n){"use strict";var r=n("a2a7"),a=n.n(r);a.a},4016:function(e,t,n){var r=n("6b7e");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var a=n("499e").default;a("7be5e102",r,!0,{sourceMap:!1,shadowMode:!1})},"4ae9":function(e,t,n){t=e.exports=n("2350")(!1),t.push([e.i,"h1{margin-top:15px}.tree-children{transition:.2s}",""])},"56d7":function(e,t,n){"use strict";n.r(t);n("7f7f"),n("cadf"),n("551c"),n("f751"),n("097d");var r=n("2b0e"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("router-view")},o=[],s=n("2877"),i={},c=Object(s["a"])(i,a,o,!1,null,null,null),u=c.exports,l=n("8c4f"),d=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("vue-drawer-layout",{ref:"drawer",attrs:{animatable:!0,backdrop:!0,"backdrop-opacity-range":[0,.4],"content-drawable":!0,"drawer-width":300,enable:e.drawerEnabled,"z-index":0},on:{"mask-click":function(t){return e.toggleMenu(!1)}}},[n("div",{staticClass:"drawer-content",attrs:{slot:"drawer"},slot:"drawer"},[n("TheDrawerMenu")],1),n("div",{staticClass:"content-class",attrs:{slot:"content"},slot:"content"},[n("TheContent"),n("resize-observer",{on:{notify:e.handleResize}})],1)])},f=[],p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"drawer-wrapper",on:{click:function(t){return e.goHome()}}},[e._m(0),n("tree",{ref:"treeMenuRef",attrs:{data:e.treeData,options:e.treeOptions},on:{"node:selected":e.onNodeSelected},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node;return n("span",{staticClass:"tree-text"},[[n("a",{staticClass:"tree-a",attrs:{href:e.getUrl(r)},on:{click:function(t){return t.preventDefault(),e.linkClick()}}},[e._v(e._s(r.text))])]],2)}}])}),n("div",{staticClass:"user-div content-center"},[e._v("\n    "+e._s(e.currentUserShortName)+"\n    Â \n    "),n("i",{staticClass:"user-avatar fas fa-user-circle"}),n("br"),n("a",{staticClass:"cursor-pointer",on:{click:function(t){return e.doLogOut()}}},[e._v(e._s(e.$t("sign-out")))]),n("br"),e.currentUserIsAdmin?n("a",{staticClass:"cursor-pointer to-admin",on:{click:function(t){return e.gotoAdmin()}}},[e._v(e._s(e.$t("goto-admin")))]):e._e()]),n("br"),n("br"),n("modal",{attrs:{adaptive:"",height:"auto",name:"change-password",scrollable:""}},[n("ax-change-password",{attrs:{guid:e.currentUserGuid,is_new:!0},on:{close:e.closePasswordModal}})],1)],1)},h=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"logo-div"},[r("img",{staticClass:"logo",attrs:{src:n("b2b5")}})])}],g=(n("7514"),n("aede")),m=(n("55dd"),n("ac6a"),n("2f62")),v=n("9530"),w=n.n(v),b=(n("8e6e"),n("456d"),n("bd86")),x=n("74ca"),y=n("c0cc"),k=n("d634"),O=n("478e"),P=n("4518"),$=n("2bf2"),T=n("c2c3"),C=(n("6762"),n("2fdb"),null),_=null;function j(){if(null==C){var e=document.getElementsByTagName("script"),t=e.length-1,n=e[t],r=new URL(n.src);C=r.host,_=r.protocol}return C}function M(){return null==_&&j(),_.includes("https")?"https":"http"}function S(){return null==_&&j(),_.includes("https")?"wss":"ws"}function D(){var e=M(),t=j();return"".concat(e,"://").concat(t)}function E(e){return e?e.includes("-")?e:"".concat(e.substr(0,8),"-").concat(e.substr(8,4),"-").concat(e.substr(12,4),"-").concat(e.substr(16,4),"-").concat(e.substr(20)):null}function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(n,!0).forEach(function(t){Object(b["a"])(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var N=j(),q=M(),z=S(),G=null,R=function(e,t){G=null;var n=fetch(e,t);return n.then(function(e){return e.text()}).then(function(n){var r=JSON.parse(n);if(r&&r.reasons&&r.reasons[0]&&"Signature has expired."==r.reasons[0]){if(!G){var a=re.state.accessToken,o=re.state.refreshToken,s="".concat(q,"://").concat(N,"/api/auth/refresh");G=fetch(s,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify({refresh_token:o,deviceGuid:window.axDeviceGuid})}).then(function(e){if(e.ok)return e.json().then(function(e){return console.log("Refresh token used. New access token recieved."),re.commit("setTokens",{access:e.access_token,refresh:e.refresh_token}),e.access_token});console.log("re-authorization request fails"),re.dispatch("logOut")}).catch(function(e){console.log("Re-authorization request fails => ".concat(e)),setTimeout(function(){re.dispatch("logOut")},1e3)})}return G.then(function(n){return G=null,t.headers.authorization="Bearer ".concat(n),fetch(e,t)})}var i={ok:!0,text:function(){return new Promise(function(e,t){e(n)})}};return i})},H=new O["a"]({uri:"".concat(q,"://").concat(N,"/api/graphql"),fetch:R}),B=new y["a"]({uri:"".concat(z,"://").concat(N,"/api/subscriptions"),options:{reconnect:!0}}),L=Object(T["a"])(function(e,t){var n=t.headers,r=re.state.accessToken;return r?{headers:U({},n,{authorization:r?"Bearer ".concat(r):""})}:{headers:n}}),I=Object(k["d"])(function(e){var t=e.query,n=Object(P["l"])(t),r=n.kind,a=n.operation;return"OperationDefinition"===r&&"subscription"===a},B,H),F=L.concat(I),J=new $["a"],W=new x["a"]({link:F,cache:J}),Y=W;function K(){var e=Object(g["a"])(["\n      query($updateTime: String, $guid: String) {\n        pageData(updateTime: $updateTime, guid: $guid) {\n          guid\n          name\n          dbName\n          html\n        }\n      }\n    "]);return K=function(){return e},e}function Q(){var e=Object(g["a"])(["\n      query($updateTime: String, $guid: String) {\n        allPages(updateTime: $updateTime) {\n          guid\n          name\n          dbName\n          parent\n          position\n        },\n        pageData(updateTime: $updateTime, guid: $guid) {\n          guid\n          name\n          dbName\n          html\n        },\n        currentAxUser (updateTime: $updateTime) {\n          guid\n          email\n          shortName\n          passwordMustChange\n          name\n          isActiveAdmin\n        },        \n      }\n    "]);return Q=function(){return e},e}r["a"].use(m["a"]);var V=function(){return{pages:[],treeStore:[],indexPageGuid:null,currentPage:null,accessToken:null,refreshToken:null,drawerEnabled:!0,toggleDrawer:!1,currentUser:null,passwordMustChange:!1}},X=function e(t,n){var r=[];return n.pages.forEach(function(a){if(a.parent===t){var o={text:a.name,data:{guid:a.guid,position:a.position},state:{},children:e(a.guid,n)};r.push(o)}}),r=r.sort(function(e,t){return e.data.position-t.data.position}),r},Z={resetState:function(e){Object.assign(e,V())},setTokens:function(e,t){e.accessToken=t.access,e.refreshToken=t.refresh},setCurrentPage:function(e,t){e.currentPage=t},setPages:function(e,t){e.pages=t,t.forEach(function(t){null===t.parent&&(e.indexPageGuid=t.guid)})},updateTreeStore:function(e,t){e.treeStore=t},setToggleDrawer:function(e,t){e.toggleDrawer=t},setDrawerEnabled:function(e,t){e.drawerEnabled=t},setCurrentUser:function(e,t){e.currentUser=t},setPasswordMustChange:function(e,t){e.passwordMustChange=t}},ee={tree:function(e){return e.treeStore}},te={logOut:function(){var e=D();setTimeout(function(){window.location.href="".concat(e,"/api/signout")},3e3)},loadAllPages:function(e,t){var n=w()(Q());Y.query({query:n,variables:{guid:t.guid,updateTime:Date.now()}}).then(function(t){var n=t.data.allPages;re.commit("setPages",n),re.commit("setCurrentPage",t.data.pageData),re.commit("setCurrentUser",t.data.currentAxUser),re.commit("setPasswordMustChange",t.data.currentAxUser.passwordMustChange);var r=n.find(function(e){return null===e.parent}),a={text:r.name,data:{guid:r.guid},state:{expanded:!0},children:X(r.guid,e.state)};console.log([a]),re.commit("updateTreeStore",[a])}).catch(function(e){console.log("Error in loadAllPages gql => ".concat(e))})},loadPageData:function(e,t){var n=w()(K());return Y.query({query:n,variables:{guid:t.guid,updateTime:Date.now()}}).then(function(e){var t=e.data.pageData;re.commit("setCurrentPage",t)}).catch(function(e){console.log("Error in loadPageData gql => ".concat(e))}),!0}},ne=V(),re=new m["a"].Store({state:ne,getters:ee,mutations:Z,actions:te}),ae=n("a78e"),oe=n.n(ae),se={name:"TheDrawerMenu",components:{},data:function(){return{guid:null,treeData:[],treeOptions:{parentSelect:!0,checkOnSelect:!1,store:{store:re,getter:function(){return re.getters.tree},dispatcher:function(e){re.commit("updateTreeStore",e)}}}}},computed:{treeDataStore:function(){return this.$store.state.treeData},currentUserShortName:function(){return this.$store.state.currentUser?this.$store.state.currentUser.shortName:null},currentUserGuid:function(){return this.$store.state.currentUser?this.$store.state.currentUser.guid:null},currentUserIsAdmin:function(){return this.$store.state.currentUser?this.$store.state.currentUser.isActiveAdmin:null},passwordMustChange:function(){return this.$store.state.passwordMustChange}},watch:{treeDataStore:function(e){e&&e.length>0&&(this.treeData=e)},passwordMustChange:function(e){e&&this.openPasswordModal()}},mounted:function(){var e=this;this.$store.commit("setTokens",{access:oe.a.get("access_token"),refresh:oe.a.get("refresh_token")}),setTimeout(function(){e.checkAuth(e.$store.state.accessToken);var t=e.$route.params.page;e.$store.dispatch("loadPageData",{guid:t}).then(function(n){setTimeout(function(){var n=e.$refs.treeMenuRef.find({data:{guid:t}});n&&(n[0].select(!0),e.expandNodeAndParents(n[0]))},400)})},150)},methods:{linkClick:function(){return!1},getUrl:function(e){return e.data.guid},expandNodeAndParents:function(e){e.expand(!0),e.parent&&this.expandNodeAndParents(e.parent)},onNodeSelected:function(e){this.$router.push({path:"/".concat(e.data.guid)})},goHome:function(){this.$router.push({path:"/".concat(this.$store.state.indexPageGuid)})},gotoAdmin:function(){var e=D();window.location.href="".concat(e,"/admin/home")},doLogOut:function(){this.$store.dispatch("logOut")},checkAuth:function(e){null!=e&&"null"!==e||(console.log("Tokens not found -> signout"),this.doLogOut())},openPasswordModal:function(){this.$modal.show("change-password")},closePasswordModal:function(){this.$modal.hide("change-password")}}},ie=se,ce=(n("62d3"),Object(s["a"])(ie,p,h,!1,null,"3cea64d0",null)),ue=ce.exports,le=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"content-wrapper"},[!1===e.drawerEnabled?r("div",{staticClass:"menu-wrapper"},[r("TheDrawerMenu")],1):e._e(),null==e.currentHtml?r("div",{staticClass:"loading-div"},[r("i",{staticClass:"loading-spinner fas fa-circle-notch fa-spin"}),r("img",{staticClass:"loading-logo",attrs:{src:n("b2b5")}})]):e._e(),r("div",{staticClass:"current-page h-full w-full",domProps:{innerHTML:e._s(e.currentHtml)}})])},de=[],fe=n("339e"),pe={name:"TheContent",components:{TheDrawerMenu:ue},data:function(){return{guid:null,converter:null}},computed:{pageId:function(){return this.$route.params.page},currentHtml:function(){if(this.$store.state.currentPage&&this.$store.state.currentPage.html){var e=this.$store.state.currentPage.html;return e}return null},drawerEnabled:function(){return this.$store.state.drawerEnabled}},watch:{pageId:function(e){e&&this.$store.dispatch("loadPageData",{guid:e})}},mounted:function(){this.converter=new fe["Converter"]},methods:{}},he=pe,ge=(n("a6cb"),Object(s["a"])(he,le,de,!1,null,"261a173f",null)),me=ge.exports,ve={name:"Home",components:{TheDrawerMenu:ue,TheContent:me},data:function(){return{guid:null}},computed:{drawerEnabled:function(){return this.$store.state.drawerEnabled}},watch:{},mounted:function(){this.handleResize();var e=this.$route.params.pagel;this.$store.dispatch("loadAllPages",{guid:e})},methods:{handleResize:function(){this.$el.clientWidth>768?this.$store.commit("setDrawerEnabled",!1):this.$store.commit("setDrawerEnabled",!0)},toggleMenu:function(e){this.$refs.drawer.toggle(e)}}},we=ve,be=(n("11be"),Object(s["a"])(we,d,f,!1,null,"4af6ba1e",null)),xe=be.exports,ye=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("ax-sign-in",{on:{signin:function(t){return e.gotoPages()}}})],1)},ke=[],Oe={name:"PagesSignin",components:{},data:function(){return{}},computed:{},watch:{},mounted:function(){},methods:{gotoPages:function(){this.$router.push({path:"/"})}}},Pe=Oe,$e=Object(s["a"])(Pe,ye,ke,!1,null,"7b6d362c",null),Te=$e.exports;r["a"].use(l["a"]);var Ce=new l["a"]({mode:"history",base:"/pages/",routes:[{path:"/signin",name:"pages-signin",component:Te},{path:"/",name:"home-default",component:xe},{path:"/:page",name:"home",component:xe}]}),_e=n("9483");Object(_e["a"])("".concat("/pages/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}});n("15f5"),n("9588");var je=n("a925"),Me=n("0262"),Se=n("cd7c"),De="en",Ee={en:Me,ru:Se};r["a"].use(je["a"]);var Ae=Object.assign(Ee),Ue={en:{short:{year:"numeric",month:"short",day:"numeric"},normal:{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric"},long:{year:"numeric",month:"short",day:"numeric",weekday:"short",hour:"numeric",minute:"numeric"}},ja:{short:{year:"numeric",month:"short",day:"numeric"},long:{year:"numeric",month:"short",day:"numeric",weekday:"short",hour:"numeric",minute:"numeric",hour12:!0}}},Ne=new je["a"]({locale:De,fallbackLocale:"en",messages:Ae,dateTimeFormats:Ue}),qe=Ne,ze=n("e813"),Ge=n.n(ze),Re=n("f77e"),He=n.n(Re),Be=n("252c"),Le=n("25ea"),Ie=n("1881"),Fe=n.n(Ie);r["a"].use(Fe.a,{dynamic:!0,injectModalsContainer:!0}),r["a"].component(Le["a"].name,Le["a"]),r["a"].use(Be["a"]),r["a"].use(He.a),r["a"].config.productionTip=!1,setTimeout(function(){var e={excludeAdBlock:!0};Ge.a.getPromise(e).then(function(e){var t=e.map(function(e){return e.value}),n=Ge.a.x64hash128(t.join(""),31),r=E(n);window.axDeviceGuid=r})},100),new r["a"]({router:Ce,store:re,i18n:qe,render:function(e){return e(u)}}).$mount("#app")},6232:function(e,t,n){t=e.exports=n("2350")(!1),t.push([e.i,".content-class[data-v-4af6ba1e]{height:100%;overflow:auto;-webkit-overflow-scrolling:touch}",""])},"62d3":function(e,t,n){"use strict";var r=n("aa3f"),a=n.n(r);a.a},"6b7e":function(e,t,n){t=e.exports=n("2350")(!1),t.push([e.i,".content-wrapper[data-v-261a173f]{display:flex;flex-direction:row}.current-page[data-v-261a173f]{width:100%}.menu-wrapper[data-v-261a173f]{min-width:300px;width:30%;padding:20px}.loading-div[data-v-261a173f]{padding-top:100px}.loading-spinner[data-v-261a173f]{position:absolute;font-size:220px;color:#ccc}.loading-logo[data-v-261a173f]{position:absolute;width:100px;margin-left:57px;margin-top:58px}",""])},9588:function(e,t,n){var r=n("4ae9");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var a=n("499e").default;a("2062c8df",r,!0,{sourceMap:!1,shadowMode:!1})},a2a7:function(e,t,n){var r=n("6232");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var a=n("499e").default;a("bf0318b4",r,!0,{sourceMap:!1,shadowMode:!1})},a6cb:function(e,t,n){"use strict";var r=n("4016"),a=n.n(r);a.a},aa3f:function(e,t,n){var r=n("0911");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var a=n("499e").default;a("fe9d35b8",r,!0,{sourceMap:!1,shadowMode:!1})},b2b5:function(e,t,n){e.exports=n.p+"static/img/small_axe.e07ab536.png"},cd7c:function(e){e.exports={common:{"lenght-error":"Must be less than {num} characters","confirm-yes":"Yes",save:"Save","confirm-no":"Cancel","position-changed":"Positions changed","error-close":"Close","field-required":"Is required",true:"True",false:"False",confirm:"Confirm",ok:"Ok","no-field-settings-error":"[{name}] - Settings error","no-column":"Column not supported for [{name}] field type","invalid-email":"Email invalid"}}}});
//# sourceMappingURL=app.6904128a.js.map